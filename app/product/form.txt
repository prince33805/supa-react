<form
              action={formAction}
              onSubmit={(e) => {
                const message =
                  imageState.success === false
                    ? 'คุณแน่ใจหรือไม่ว่าต้องการส่งข้อมูลโดยที่ไม่มีการเปลี่ยนแปลงรูปภาพ?'
                    : 'คุณแน่ใจหรือไม่ว่าต้องการส่งข้อมูล?';

                const confirmed = window.confirm(message);
                if (!confirmed) {
                  e.preventDefault();
                }
              }}
            >
              {/* Hidden: mode + id for updates */}
              <input type="hidden" name="mode" value={mode} />
              {mode === 'edit' && (
                <input type="hidden" name="id" value={currentProduct.id} />
              )}

              {/* Image Preview Section */}
              <div className="flex items-center gap-4 mb-6">
                {mode === 'view' && currentProduct.attachments && (
                  <img
                    src={currentProduct.attachments}
                    alt={currentProduct.name}
                    className="w-16 h-16 rounded-full object-cover border"
                  />
                )}

                {(mode === 'edit' || mode === 'create') && (
                  <>
                    {previewImage ? (
                      <img
                        src={previewImage}
                        alt="Preview"
                        className="w-16 h-16 rounded-full object-cover border"
                      />
                    ) : currentProduct.attachments ? (
                      <img
                        src={currentProduct.attachments}
                        alt={currentProduct.name}
                        className="w-16 h-16 rounded-full object-cover border"
                      />
                    ) : (
                      <div className="w-16 h-16 rounded-full border bg-gray-100 flex items-center justify-center text-gray-400 text-sm">
                        No Image
                      </div>
                    )}
                  </>
                )}
              </div>

              {/* Image File Input */}
              {mode !== 'view' && (
                <div className="mb-4">
                  <label className="block text-sm font-medium mb-1">
                    Upload Image
                  </label>
                  <input
                    type="file"
                    name="image"
                    // accept="image/png, image/jpeg"
                    className="text-sm"
                    onChange={handleImageChange}
                  />
                </div>
              )}

              {/* Text Fields */}
              <div className="space-y-4">
                <div>
                  <label className="block text-sm text-gray-600 font-medium mb-1">
                    Name
                  </label>
                  <input
                    name="name"
                    defaultValue={currentProduct.name}
                    disabled={mode === 'view'}
                    required
                    className="w-full rounded-lg border px-3 py-2 text-sm disabled:bg-gray-100"
                  />
                </div>
                <div>
                  <label className="block text-sm text-gray-600 font-medium mb-1">
                    Cost
                  </label>
                  <input
                    name="cost"
                    type="number"
                    step="0.01"
                    defaultValue={currentProduct.cost}
                    disabled={mode === 'view'}
                    required
                    className="w-full rounded-lg border px-3 py-2 text-sm disabled:bg-gray-100"
                  />
                </div>
                <div>
                  <label className="block text-sm text-gray-600 font-medium mb-1">
                    Price
                  </label>
                  <input
                    name="price"
                    type="number"
                    step="0.01"
                    defaultValue={currentProduct.price}
                    disabled={mode === 'view'}
                    required
                    className="w-full rounded-lg border px-3 py-2 text-sm disabled:bg-gray-100"
                  />
                </div>
              </div>

              {/* Error or success message */}
              {shouldShowError && formState?.success === false && (
                <p className="mt-4 text-sm text-red-500">{formState.message}</p>
              )}
              {imageState?.success === false && (
                <p className="mt-4 text-sm text-red-500">
                  {imageState.message}
                </p>
              )}

              <div className="mt-6 flex justify-end gap-3">
                {mode !== 'view' && (
                  <button
                    type="submit"
                    className="px-4 py-2 text-sm font-medium bg-green-600 text-white hover:bg-green-700 rounded-lg"
                  >
                    Save
                  </button>
                )}
                <button
                  type="button"
                  onClick={handleClose}
                  className="px-4 py-2 text-sm font-medium bg-gray-100 hover:bg-gray-200 rounded-lg"
                >
                  Close
                </button>
              </div>
            </form>